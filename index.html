<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Anuncios - Iglesia</title>
    <style>
        /* Estilos generales */
        :root {
            --azul-principal: #1e3a8a;
            --azul-secundario: #3b82f6;
            --azul-claro: #dbeafe;
            --blanco: #ffffff;
            --gris-claro: #f3f4f6;
            --gris: #9ca3af;
            --gris-oscuro: #374151;
            --sombra: 0 4px 6px rgba(0, 0, 0, 0.1);
            --verde: #10b981;
            --rojo: #ef4444;
            --naranja: #f59e0b;
            --morado: #8b5cf6;
            --amarillo: #fbbf24;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--gris-claro);
            color: var(--gris-oscuro);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* Encabezado */
        .header {
            background-color: var(--azul-principal);
            color: var(--blanco);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--sombra);
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }
        
        .logo h1 {
            font-size: 1.4rem;
            font-weight: 600;
        }
        
        .logo-icon {
            font-size: 1.8rem;
        }
        
        /* Formulario de login */
        .login-container {
            position: relative;
            display: flex;
            gap: 0.5rem;
        }
        
        .login-btn, .admin-view-btn {
            background-color: var(--azul-secundario);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
            font-size: 0.9rem;
        }
        
        .login-btn:hover, .admin-view-btn:hover {
            background-color: #2563eb;
        }
        
        .admin-view-btn {
            background-color: var(--verde);
        }
        
        .admin-view-btn:hover {
            background-color: #0da271;
        }
        
        .login-form {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: var(--blanco);
            padding: 1.2rem;
            border-radius: 8px;
            box-shadow: var(--sombra);
            width: 300px;
            display: none;
            z-index: 100;
            margin-top: 0.5rem;
        }
        
        .login-form.active {
            display: block;
        }
        
        .login-form h3 {
            margin-bottom: 1rem;
            color: var(--azul-principal);
            text-align: center;
            font-size: 1.1rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.3rem;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .form-group input {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid var(--gris);
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: var(--azul-secundario);
        }
        
        .submit-btn {
            background-color: var(--azul-principal);
            color: white;
            border: none;
            padding: 0.6rem;
            width: 100%;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }
        
        .submit-btn:hover {
            background-color: #1d4ed8;
        }
        
        .logout-btn {
            background-color: var(--rojo);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
            display: none;
            font-size: 0.9rem;
        }
        
        .logout-btn:hover {
            background-color: #b91c1c;
        }
        
        /* Bot√≥n de volver */
        .back-btn {
            background-color: var(--gris);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
            font-size: 0.9rem;
        }
        
        .back-btn:hover {
            background-color: #6b7280;
        }
        
        /* Contenedor principal */
        .container {
            max-width: 1200px;
            margin: 1.5rem auto;
            padding: 0 1rem;
        }
        
        /* Mensaje de bienvenida */
        .welcome-message {
            background-color: var(--blanco);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--sombra);
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .welcome-message h2 {
            color: var(--azul-principal);
            margin-bottom: 0.5rem;
        }
        
        /* Pantallas de selecci√≥n */
        .selection-screen {
            background-color: var(--blanco);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--sombra);
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .selection-screen h2 {
            color: var(--azul-principal);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            text-align: center;
        }
        
        .departments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .department-card {
            background-color: var(--azul-claro);
            border-radius: 8px;
            padding: 1.2rem 1rem;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid transparent;
            text-align: center;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .department-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--sombra);
            border-color: var(--azul-secundario);
        }
        
        .department-card.juvenil {
            background-color: #e0f2fe;
        }
        
        .department-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: var(--azul-principal);
        }
        
        .department-card h3 {
            color: var(--azul-principal);
            font-size: 1rem;
            margin-bottom: 0.3rem;
        }
        
        .department-card p {
            color: var(--gris-oscuro);
            font-size: 0.8rem;
        }
        
        /* Opciones JA y Clubes */
        .option-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .option-card {
            background-color: var(--blanco);
            border-radius: 8px;
            padding: 1.5rem 1rem;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid var(--azul-claro);
            text-align: center;
        }
        
        .option-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--sombra);
            border-color: var(--azul-secundario);
        }
        
        .option-card.ja {
            background-color: #dbeafe;
        }
        
        .option-card.clubes {
            background-color: #e0f2fe;
        }
        
        .option-card h4 {
            color: var(--azul-principal);
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }
        
        .option-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: var(--azul-principal);
        }
        
        /* Subcategor√≠as para Clubes */
        .subcategories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .subcategory-card {
            background-color: var(--blanco);
            border-radius: 8px;
            padding: 1.5rem 1rem;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid var(--azul-claro);
            text-align: center;
        }
        
        .subcategory-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--sombra);
            border-color: var(--azul-secundario);
        }
        
        .subcategory-card h4 {
            color: var(--azul-principal);
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }
        
        /* Secci√≥n de formulario de anuncios */
        .announcement-form-section {
            background-color: var(--blanco);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--sombra);
            margin-bottom: 1.5rem;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .announcement-form-section.active {
            display: block;
        }
        
        .section-title {
            color: var(--azul-principal);
            margin-bottom: 1.2rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--azul-claro);
            font-size: 1.3rem;
        }
        
        .announcement-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .form-control {
            display: flex;
            flex-direction: column;
        }
        
        .form-control label {
            margin-bottom: 0.4rem;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .form-control select, 
        .form-control input, 
        .form-control textarea {
            padding: 0.6rem;
            border: 1px solid var(--gris);
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .form-control textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-control select:focus, 
        .form-control input:focus, 
        .form-control textarea:focus {
            outline: none;
            border-color: var(--azul-secundario);
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .btn-submit-announcement {
            grid-column: 1 / -1;
            background-color: var(--azul-principal);
            color: white;
            border: none;
            padding: 0.7rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.95rem;
            transition: background-color 0.3s;
        }
        
        .btn-submit-announcement:hover {
            background-color: #1d4ed8;
        }
        
        /* √Årea de carga de archivos */
        .file-upload-container {
            grid-column: 1 / -1;
            margin-top: 1rem;
        }
        
        .file-upload-area {
            border: 2px dashed var(--gris);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s, background-color 0.3s;
            background-color: var(--gris-claro);
        }
        
        .file-upload-area:hover {
            border-color: var(--azul-secundario);
            background-color: var(--azul-claro);
        }
        
        .file-upload-area.drag-over {
            border-color: var(--verde);
            background-color: #dcfce7;
        }
        
        .file-upload-icon {
            font-size: 3rem;
            color: var(--gris);
            margin-bottom: 1rem;
        }
        
        .file-upload-area:hover .file-upload-icon {
            color: var(--azul-principal);
        }
        
        .file-upload-text {
            margin-bottom: 1rem;
            color: var(--gris-oscuro);
        }
        
        .file-input-label {
            background-color: var(--azul-secundario);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            display: inline-block;
            transition: background-color 0.3s;
        }
        
        .file-input-label:hover {
            background-color: #2563eb;
        }
        
        .file-input {
            display: none;
        }
        
        .files-list {
            margin-top: 1.5rem;
        }
        
        .files-list h4 {
            color: var(--azul-principal);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        
        .file-item {
            background-color: var(--gris-claro);
            padding: 0.8rem;
            border-radius: 8px;
            margin-bottom: 0.8rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
            border: 1px solid var(--gris-claro);
            transition: border-color 0.3s;
        }
        
        .file-item:hover {
            border-color: var(--azul-secundario);
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
        }
        
        .file-icon {
            font-size: 1.2rem;
            color: var(--azul-principal);
        }
        
        .file-details {
            flex: 1;
        }
        
        .file-name {
            font-weight: 500;
            color: var(--gris-oscuro);
            word-break: break-all;
        }
        
        .file-size {
            font-size: 0.85rem;
            color: var(--gris);
        }
        
        .file-remove {
            background: none;
            border: none;
            color: var(--rojo);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.2rem;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .file-remove:hover {
            background-color: rgba(239, 68, 68, 0.1);
        }
        
        .file-success-message {
            background-color: #dcfce7;
            color: #166534;
            padding: 0.5rem;
            border-radius: 4px;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            text-align: center;
            display: none;
        }
        
        /* Secci√≥n para mostrar anuncios */
        .announcements-section {
            background-color: var(--blanco);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--sombra);
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .announcements-section.active {
            display: block;
        }
        
        .current-department {
            background-color: var(--azul-claro);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .current-department h3 {
            color: var(--azul-principal);
            font-size: 1.2rem;
        }
        
        .announcements-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.2rem;
        }
        
        .announcement-card {
            background-color: var(--azul-claro);
            border-radius: 8px;
            padding: 1.2rem;
            border-left: 4px solid var(--azul-principal);
            position: relative;
            animation: fadeIn 0.5s ease;
        }
        
        .announcement-card.mine {
            border-left-color: var(--naranja);
        }
        
        .announcement-card h3 {
            color: var(--azul-principal);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
            padding-right: 50px;
        }
        
        .announcement-meta {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
            margin-bottom: 0.8rem;
            font-size: 0.85rem;
            color: var(--gris-oscuro);
        }
        
        .announcement-category {
            background-color: var(--azul-secundario);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            display: inline-block;
            margin-bottom: 0.5rem;
        }
        
        .announcement-description {
            margin-top: 0.8rem;
            line-height: 1.5;
            font-size: 0.9rem;
        }
        
        .announcement-author {
            font-size: 0.8rem;
            color: var(--gris-oscuro);
            margin-top: 0.8rem;
            padding-top: 0.5rem;
            border-top: 1px dashed var(--gris);
        }
        
        /* Botones de acci√≥n */
        .announcement-actions {
            position: absolute;
            top: 1.2rem;
            right: 1.2rem;
            display: flex;
            gap: 0.4rem;
        }
        
        .action-btn {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            transition: transform 0.2s;
        }
        
        .action-btn:hover {
            transform: scale(1.1);
        }
        
        .edit-btn {
            background-color: var(--verde);
            color: white;
        }
        
        .delete-btn {
            background-color: var(--rojo);
            color: white;
        }
        
        .details-btn {
            background-color: var(--morado);
            color: white;
        }
        
        /* Checkbox para selecci√≥n m√∫ltiple */
        .announcement-checkbox {
            position: absolute;
            top: 1.2rem;
            left: 1.2rem;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .announcement-card.selectable {
            padding-left: 3rem;
        }
        
        /* Barra de acciones para selecci√≥n m√∫ltiple */
        .selection-toolbar {
            background-color: var(--azul-claro);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .selection-toolbar.active {
            display: flex;
        }
        
        .selection-info {
            font-weight: 500;
            color: var(--azul-principal);
        }
        
        .selection-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .select-all-btn {
            background-color: var(--gris);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }
        
        .select-all-btn:hover {
            background-color: #6b7280;
        }
        
        .delete-selected-btn {
            background-color: var(--rojo);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }
        
        .delete-selected-btn:hover {
            background-color: #b91c1c;
        }
        
        .cancel-selection-btn {
            background-color: var(--gris);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }
        
        .cancel-selection-btn:hover {
            background-color: #6b7280;
        }
        
        /* Bot√≥n para activar selecci√≥n m√∫ltiple */
        .multi-delete-btn {
            background-color: var(--rojo);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .multi-delete-btn:hover {
            background-color: #b91c1c;
        }
        
        /* Panel de administrador */
        .admin-panel {
            background-color: var(--blanco);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--sombra);
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .admin-panel.active {
            display: block;
        }
        
        .admin-announcements {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.2rem;
        }
        
        /* Modal de detalles */
        .details-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 1rem;
        }
        
        .details-modal.active {
            display: flex;
        }
        
        .details-content {
            background-color: var(--blanco);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            border-radius: 12px;
            box-shadow: var(--sombra);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        
        .details-header {
            background-color: var(--azul-principal);
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .details-header h3 {
            font-size: 1.3rem;
            margin: 0;
        }
        
        .details-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            line-height: 1;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .details-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .details-body {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
        }
        
        .details-section {
            margin-bottom: 1.5rem;
        }
        
        .details-section h4 {
            color: var(--azul-principal);
            margin-bottom: 0.8rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--azul-claro);
            font-size: 1.1rem;
        }
        
        .detail-row {
            display: flex;
            margin-bottom: 0.8rem;
        }
        
        .detail-label {
            font-weight: 600;
            min-width: 120px;
            color: var(--gris-oscuro);
        }
        
        .detail-value {
            flex: 1;
            color: var(--gris-oscuro);
            line-height: 1.5;
        }
        
        .file-preview-container {
            margin-top: 1.5rem;
        }
        
        .file-preview {
            border: 1px solid var(--gris-claro);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 0.5rem;
            background-color: var(--gris-claro);
            max-height: 400px;
            overflow-y: auto;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 300px;
            display: block;
            margin: 0 auto;
            border-radius: 4px;
        }
        
        .video-preview {
            width: 100%;
            max-height: 300px;
            border-radius: 4px;
        }
        
        .pdf-preview {
            width: 100%;
            height: 400px;
            border: none;
            border-radius: 4px;
        }
        
        .no-preview {
            text-align: center;
            padding: 2rem;
            color: var(--gris);
            font-size: 0.9rem;
        }
        
        .preview-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .preview-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .preview-download-btn {
            background-color: var(--verde);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .preview-download-btn:hover {
            background-color: #0da271;
        }
        
        /* Panel de edici√≥n de anuncios */
        .edit-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .edit-panel.active {
            display: flex;
        }
        
        .edit-form {
            background-color: var(--blanco);
            width: 90%;
            max-width: 600px;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: var(--sombra);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .edit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
        }
        
        .edit-header h3 {
            color: var(--azul-principal);
            font-size: 1.2rem;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gris-oscuro);
        }
        
        /* Mensajes */
        .message {
            padding: 0.8rem;
            border-radius: 4px;
            margin-bottom: 1.2rem;
            text-align: center;
            display: none;
            font-size: 0.9rem;
        }
        
        .message.success {
            background-color: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
            display: block;
        }
        
        .message.error {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
            display: block;
        }
        
        .message.info {
            background-color: var(--azul-claro);
            color: var(--azul-principal);
            border: 1px solid var(--azul-secundario);
            display: block;
        }
        
        .message.warning {
            background-color: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
            display: block;
        }
        
        .empty-message {
            grid-column: 1 / -1;
            text-align: center;
            padding: 1.5rem;
            color: var(--gris);
            font-size: 0.95rem;
        }
        
        /* Estado de carga */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,.3);
            border-radius: 50%;
            border-top-color: var(--azul-principal);
            animation: spin 1s ease-in-out infinite;
            margin-right: 0.5rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Informaci√≥n de la nube */
        .cloud-info {
            background-color: var(--azul-claro);
            padding: 0.8rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-size: 0.85rem;
            color: var(--azul-principal);
            text-align: center;
        }
        
        /* Instrucciones */
        .instructions {
            background-color: var(--blanco);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            border: 1px solid var(--gris);
        }
        
        .instructions h4 {
            color: var(--azul-principal);
            margin-bottom: 0.5rem;
        }
        
        .instructions ul {
            padding-left: 1.2rem;
            font-size: 0.85rem;
        }
        
        /* Barra de navegaci√≥n de pasos */
        .step-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--azul-claro);
        }
        
        .step-title {
            color: var(--azul-principal);
            font-size: 1.3rem;
            flex-grow: 1;
            text-align: center;
        }
        
        /* Estado de conexi√≥n */
        .connection-status {
            position: fixed;
            bottom: 10px;
            right: 10px;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            z-index: 1000;
            background-color: white;
            box-shadow: var(--sombra);
        }
        
        .connection-status.online {
            background-color: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        
        .connection-status.offline {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        
        /* Modal de √©xito */
        .success-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        
        .success-modal.active {
            display: flex;
        }
        
        .success-modal-content {
            background-color: var(--blanco);
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: var(--sombra);
            animation: fadeIn 0.3s ease;
        }
        
        .success-icon {
            font-size: 3rem;
            color: var(--verde);
            margin-bottom: 1rem;
        }
        
        .success-modal-content h3 {
            color: var(--azul-principal);
            margin-bottom: 1rem;
        }
        
        .success-modal-content p {
            margin-bottom: 1.5rem;
            color: var(--gris-oscuro);
        }
        
        /* Overlay de carga */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            flex-direction: column;
        }
        
        .loading-overlay.active {
            display: flex;
        }
        
        .loading-overlay-content {
            text-align: center;
            padding: 2rem;
            background-color: var(--blanco);
            border-radius: 8px;
            box-shadow: var(--sombra);
            animation: fadeIn 0.3s ease;
        }
        
        .loading-overlay-icon {
            font-size: 3rem;
            color: var(--azul-principal);
            margin-bottom: 1rem;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* Responsive mejorado para tel√©fonos */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
                padding: 0.8rem;
            }
            
            .logo {
                flex-direction: column;
                gap: 0.5rem;
                margin-bottom: 0.5rem;
            }
            
            .logo h1 {
                font-size: 1.2rem;
                text-align: center;
            }
            
            .login-container {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .login-form {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 90%;
                max-width: 300px;
            }
            
            .departments-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .department-card {
                min-height: 100px;
                padding: 1rem 0.8rem;
            }
            
            .department-icon {
                font-size: 1.8rem;
            }
            
            .department-card h3 {
                font-size: 0.9rem;
                margin-bottom: 0.2rem;
            }
            
            .department-card p {
                font-size: 0.75rem;
                line-height: 1.2;
            }
            
            .subcategories-grid, .option-cards {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
            
            .announcement-form {
                grid-template-columns: 1fr;
                gap: 0.8rem;
            }
            
            .announcements-container, .admin-announcements {
                grid-template-columns: 1fr;
            }
            
            .announcement-card h3 {
                padding-right: 0;
                margin-bottom: 0.8rem;
                font-size: 1rem;
            }
            
            .announcement-actions {
                position: static;
                margin-bottom: 0.8rem;
                justify-content: flex-end;
            }
            
            .current-department {
                flex-direction: column;
                align-items: stretch;
                gap: 0.8rem;
                padding: 0.8rem;
            }
            
            .current-department h3 {
                font-size: 1.1rem;
                text-align: center;
                width: 100%;
            }
            
            .container {
                padding: 0 0.8rem;
                margin: 1rem auto;
            }
            
            .connection-status {
                bottom: 5px;
                right: 5px;
                font-size: 0.7rem;
                padding: 6px 10px;
            }
            
            .step-nav {
                flex-direction: column;
                gap: 0.8rem;
                align-items: stretch;
            }
            
            .step-title {
                font-size: 1.1rem;
                order: 2;
            }
            
            .back-btn {
                align-self: flex-start;
                order: 1;
            }
            
            .submit-btn {
                order: 3;
                margin-top: 0;
            }
            
            .selection-screen {
                padding: 1rem;
            }
            
            .selection-screen h2 {
                font-size: 1.3rem;
                margin-bottom: 1rem;
            }
            
            .cloud-info {
                font-size: 0.8rem;
                padding: 0.6rem;
            }
            
            /* √Årea de carga de archivos responsive */
            .file-upload-area {
                padding: 1.5rem;
            }
            
            .file-upload-icon {
                font-size: 2.5rem;
            }
            
            .file-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.8rem;
            }
            
            .file-info {
                width: 100%;
            }
            
            .file-remove {
                align-self: flex-end;
            }
            
            /* Modal de detalles responsive */
            .details-content {
                width: 95%;
                max-height: 85vh;
            }
            
            .details-header {
                padding: 1rem;
            }
            
            .details-body {
                padding: 1rem;
            }
            
            .detail-row {
                flex-direction: column;
                gap: 0.3rem;
            }
            
            .detail-label {
                min-width: auto;
            }
            
            .pdf-preview {
                height: 300px;
            }
            
            /* Barra de selecci√≥n responsive */
            .selection-toolbar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .selection-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .success-modal-content {
                padding: 1.5rem;
                margin: 1rem;
            }
            
            .success-icon {
                font-size: 2.5rem;
            }
            
            .loading-overlay-content {
                padding: 1.5rem;
                margin: 1rem;
            }
            
            .loading-overlay-icon {
                font-size: 2.5rem;
            }
        }
        
        @media (max-width: 480px) {
            .departments-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.8rem;
            }
            
            .subcategories-grid, .option-cards {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.8rem;
            }
            
            .department-card {
                min-height: 90px;
                padding: 0.8rem 0.6rem;
            }
            
            .logo h1 {
                font-size: 1.1rem;
            }
            
            .section-title {
                font-size: 1.2rem;
            }
            
            .announcement-card {
                padding: 1rem;
            }
            
            .announcement-card h3 {
                font-size: 0.95rem;
            }
            
            .announcement-description {
                font-size: 0.85rem;
            }
            
            .welcome-message {
                padding: 1rem;
            }
            
            .welcome-message h2 {
                font-size: 1.2rem;
            }
            
            .welcome-message p {
                font-size: 0.9rem;
            }
            
            .file-upload-area {
                padding: 1rem;
            }
            
            .file-upload-icon {
                font-size: 2rem;
            }
            
            .file-upload-text {
                font-size: 0.9rem;
            }
            
            .file-input-label {
                padding: 0.4rem 0.8rem;
                font-size: 0.85rem;
            }
            
            .details-header h3 {
                font-size: 1.1rem;
            }
            
            .announcement-checkbox {
                top: 0.8rem;
                left: 0.8rem;
            }
            
            .announcement-card.selectable {
                padding-left: 2.5rem;
            }
        }
        
        @media (max-width: 360px) {
            .departments-grid {
                grid-template-columns: 1fr;
            }
            
            .subcategories-grid, .option-cards {
                grid-template-columns: 1fr;
            }
            
            .department-card {
                min-height: 85px;
            }
            
            .logo h1 {
                font-size: 1rem;
            }
            
            .login-btn, .logout-btn, .admin-view-btn, .back-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
            
            .file-upload-area {
                padding: 0.8rem;
            }
            
            .file-upload-text {
                font-size: 0.85rem;
            }
        }
    </style>
    
    <!-- Firebase SDK version 12.7.0 -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getDatabase, ref, set, remove, onValue } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";
        
        // Tu configuraci√≥n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBLASmgZ4vwEyUEJ-A2xx3pihcgvipEaiE",
            authDomain: "iglesia-anuncios.firebaseapp.com",
            databaseURL: "https://iglesia-anuncios-default-rtdb.firebaseio.com",
            projectId: "iglesia-anuncios",
            storageBucket: "iglesia-anuncios.firebasestorage.app",
            messagingSenderId: "6291270000",
            appId: "1:6291270000:web:abb42fefab0c938a1ec7b5"
        };
        
        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        // Hacer disponible en el scope global
        window.firebaseDatabase = database;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebaseRemove = remove;
        window.firebaseOnValue = onValue;
        
        console.log("Firebase inicializado correctamente");
    </script>
</head>
<body>
    <!-- Encabezado con login -->
    <header class="header">
        <div class="logo">
            <div class="logo-icon">‚õ™</div>
            <h1>Gestor de Anuncios - Iglesia</h1>
        </div>
        <div class="login-container">
            <button id="loginBtn" class="login-btn">Iniciar Sesi√≥n</button>
            <div id="loginForm" class="login-form">
                <h3>Acceso Administrador</h3>
                <div class="form-group">
                    <label for="username">Usuario:</label>
                    <input type="text" id="username" placeholder="Ingresa tu usuario" autocomplete="off">
                </div>
                <div class="form-group">
                    <label for="password">Contrase√±a:</label>
                    <input type="password" id="password" placeholder="Ingresa tu contrase√±a" autocomplete="off">
                </div>
                <button id="submitLogin" class="submit-btn">Ingresar</button>
            </div>
            <button id="logoutBtn" class="logout-btn">Cerrar Sesi√≥n</button>
            <button id="adminViewBtn" class="admin-view-btn" style="display: none;">Vista Admin</button>
        </div>
    </header>

    <!-- Overlay de carga -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-overlay-content">
            <div class="loading-overlay-icon">‚è≥</div>
            <h3 id="loadingTitle">Cargando...</h3>
            <p id="loadingMessage">Por favor espera mientras se actualiza la p√°gina.</p>
            <div class="loading" style="margin: 1rem auto;"></div>
        </div>
    </div>

    <!-- Contenido principal -->
    <main class="container">
        <!-- Mensaje de bienvenida -->
        <div id="welcomeMessage" class="welcome-message">
            <h2>Bienvenido al Sistema de Anuncios de la Iglesia</h2>
            <p>Selecciona tu departamento o ministerio para publicar un anuncio</p>
            <p style="margin-top: 1rem; font-size: 0.9rem; color: #666;">
                <strong>IMPORTANTE:</strong> La p√°gina se recargar√° autom√°ticamente despu√©s de ciertas acciones
            </p>
            <div id="syncStatus" class="message info" style="margin-top: 1rem; display: none;">
                <span id="syncStatusText">Conectando con la base de datos...</span>
            </div>
        </div>

        <!-- Pantalla de selecci√≥n de departamento principal -->
        <section id="departmentSelection" class="selection-screen">
            <div class="step-nav">
                <button id="backBtn" class="back-btn" style="display: none;">‚Üê Volver</button>
                <h2 class="step-title">Selecciona tu Departamento o Ministerio</h2>
            </div>
            <div class="departments-grid">
                <!-- Ministerio Joven -->
                <div class="department-card juvenil" data-department="Ministerio Joven">
                    <div class="department-icon">üë®‚Äçüéì</div>
                    <h3>Ministerio Joven</h3>
                    <p>JA y Clubes (Aventureros, Conquistadores, Gu√≠as)</p>
                </div>
                
                <!-- Ministerio Infantil -->
                <div class="department-card" data-department="Ministerio Infantil">
                    <div class="department-icon">üë∂</div>
                    <h3>Ministerio Infantil</h3>
                    <p>Anuncios para ni√±os</p>
                </div>
                
                <!-- Escuela Sab√°tica -->
                <div class="department-card" data-department="Escuela Sab√°tica">
                    <div class="department-icon">üìö</div>
                    <h3>Escuela Sab√°tica</h3>
                    <p>Clases y estudios b√≠blicos</p>
                </div>
                
                <!-- Ministerio Personal -->
                <div class="department-card" data-department="Ministerio Personal">
                    <div class="department-icon">üôè</div>
                    <h3>Ministerio Personal</h3>
                    <p>Crecimiento espiritual</p>
                </div>
                
                <!-- Ministerio de la Mujer -->
                <div class="department-card" data-department="Ministerio de la Mujer">
                    <div class="department-icon">üë©</div>
                    <h3>Ministerio de la Mujer</h3>
                    <p>Actividades para mujeres</p>
                </div>
                
                <!-- Ministerio de la Familia -->
                <div class="department-card" data-department="Ministerio de la Familia">
                    <div class="department-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                    <h3>Ministerio de la Familia</h3>
                    <p>Anuncios familiares</p>
                </div>
                
                <!-- Mayordom√≠a Cristiana -->
                <div class="department-card" data-department="Mayordom√≠a Cristiana">
                    <div class="department-icon">üíº</div>
                    <h3>Mayordom√≠a Cristiana</h3>
                    <p>Administraci√≥n y recursos</p>
                </div>
                
                <!-- Ministerio de Salud -->
                <div class="department-card" data-department="Ministerio de Salud">
                    <div class="department-icon">üè•</div>
                    <h3>Ministerio de Salud</h3>
                    <p>Salud y bienestar</p>
                </div>
                
                <!-- Comunicaci√≥n -->
                <div class="department-card" data-department="Comunicaci√≥n">
                    <div class="department-icon">üì¢</div>
                    <h3>Comunicaci√≥n</h3>
                    <p>Medios y difusi√≥n</p>
                </div>
                
                <!-- Director de Canto -->
                <div class="department-card" data-department="Director de Canto">
                    <div class="department-icon">üé§</div>
                    <h3>Director de Canto</h3>
                    <p>Alabanza y m√∫sica</p>
                </div>
                
                <!-- Director de Sonido -->
                <div class="department-card" data-department="Director de Sonido">
                    <div class="department-icon">üéß</div>
                    <h3>Director de Sonido</h3>
                    <p>Audiovisual y sonido</p>
                </div>
                
                <!-- Dorcas -->
                <div class="department-card" data-department="Dorcas">
                    <div class="department-icon">‚ù§Ô∏è</div>
                    <h3>Dorcas</h3>
                    <p>Servicio y ayuda social</p>
                </div>
                
                <!-- Libertad Religiosa -->
                <div class="department-card" data-department="Libertad Religiosa">
                    <div class="department-icon">‚öñÔ∏è</div>
                    <h3>Libertad Religiosa</h3>
                    <p>Derechos y libertades</p>
                </div>
                
                <!-- Di√°conos y Diaconisas -->
                <div class="department-card" data-department="Di√°conos y Diaconisas">
                    <div class="department-icon">üë®‚Äçüíº</div>
                    <h3>Di√°conos y Diaconisas</h3>
                    <p>Servicio en la iglesia</p>
                </div>
                
                <!-- Ancianos de Iglesia -->
                <div class="department-card" data-department="Ancianos de Iglesia">
                    <div class="department-icon">üë¥</div>
                    <h3>Ancianos de Iglesia</h3>
                    <p>Consejo de ancianos</p>
                </div>
                
                <!-- Secretar√≠a -->
                <div class="department-card" data-department="Secretar√≠a de Iglesia">
                    <div class="department-icon">üìù</div>
                    <h3>Secretar√≠a de Iglesia</h3>
                    <p>Documentaci√≥n y registros</p>
                </div>
                
                <!-- Tesorer√≠a -->
                <div class="department-card" data-department="Tesoreria">
                    <div class="department-icon">üí∞</div>
                    <h3>Tesoreria</h3>
                    <p>Finanzas de la iglesia</p>
                </div>
            </div>
            
            <!-- Informaci√≥n de la nube -->
            <div class="cloud-info">
                ‚ÑπÔ∏è Los anuncios se guardan autom√°ticamente en la nube. El administrador puede ver todos los anuncios desde cualquier dispositivo.
            </div>
        </section>

        <!-- Pantalla de selecci√≥n Ministerio Joven (JA o Clubes) -->
        <section id="juvenilSelection" class="selection-screen" style="display: none;">
            <div class="step-nav">
                <button id="backToDepartmentsBtn" class="back-btn">‚Üê Volver</button>
                <h2 class="step-title">Ministerio Joven - Selecciona una opci√≥n</h2>
            </div>
            <div class="option-cards">
                <div class="option-card ja" data-option="JA">
                    <div class="option-icon">üôã‚Äç‚ôÇÔ∏è</div>
                    <h4>J√≥venes Adventistas (JA)</h4>
                    <p>Anuncios para j√≥venes de 16+ a√±os</p>
                </div>
                <div class="option-card clubes" data-option="Clubes">
                    <div class="option-icon">üèïÔ∏è</div>
                    <h4>Clubes</h4>
                    <p>Aventureros, Conquistadores, Gu√≠as Mayores</p>
                </div>
            </div>
        </section>

        <!-- Pantalla de selecci√≥n de Clubes -->
        <section id="clubesSelection" class="selection-screen" style="display: none;">
            <div class="step-nav">
                <button id="backToJuvenilBtn" class="back-btn">‚Üê Volver</button>
                <h2 class="step-title">Clubes - Selecciona un club</h2>
            </div>
            <div class="subcategories-grid">
                <div class="subcategory-card" data-department="Aventureros">
                    <div class="option-icon">üßí</div>
                    <h4>Aventureros</h4>
                    <p>Ni√±os 6-9 a√±os</p>
                </div>
                <div class="subcategory-card" data-department="Conquistadores">
                    <div class="option-icon">üßë</div>
                    <h4>Conquistadores</h4>
                    <p>J√≥venes 10-15 a√±os</p>
                </div>
                <div class="subcategory-card" data-department="Gu√≠as Mayores">
                    <div class="option-icon">üë®‚Äçüéì</div>
                    <h4>Gu√≠as Mayores</h4>
                    <p>J√≥venes 16-21 a√±os</p>
                </div>
            </div>
        </section>

        <!-- Secci√≥n de formulario de anuncios -->
        <section id="announcementFormSection" class="announcement-form-section">
            <div class="step-nav">
                <button id="backToSelectionBtn" class="back-btn">‚Üê Volver</button>
                <h2 class="step-title" id="formSectionTitle">Crear Nuevo Anuncio</h2>
            </div>
            <form id="announcementForm" class="announcement-form">
                <input type="hidden" id="selectedDepartment">
                <div class="form-control">
                    <label for="time">Hora de inicio (opcional):</label>
                    <input type="time" id="time">
                </div>
                <div class="form-control">
                    <label for="endTime">Hora de fin (opcional):</label>
                    <input type="time" id="endTime">
                </div>
                <div class="form-control">
                    <label for="date">Fecha de inicio:</label>
                    <input type="date" id="date" required>
                </div>
                <div class="form-control">
                    <label for="endDate">Fecha de fin (opcional):</label>
                    <input type="date" id="endDate">
                </div>
                <div class="form-control">
                    <label for="title">T√≠tulo del anuncio:</label>
                    <input type="text" id="title" placeholder="Ej: Reuni√≥n de oraci√≥n" required>
                </div>
                <div class="form-control">
                    <label for="author">Tu nombre (autor):</label>
                    <input type="text" id="author" placeholder="Tu nombre" required>
                </div>
                <div class="form-control full-width">
                    <label for="description">Descripci√≥n:</label>
                    <textarea id="description" placeholder="Describe los detalles del anuncio..." required></textarea>
                </div>
                
                <!-- √Årea de carga de archivos -->
                <div class="file-upload-container">
                    <label for="fileUpload" style="margin-bottom: 0.8rem; display: block; font-weight: 500; font-size: 0.9rem;">
                        Subir archivos (opcional):
                        <span style="font-size: 0.8rem; color: var(--gris); font-weight: normal;">
                            Puedes subir im√°genes, videos, PDF, Excel, Word o PowerPoint
                        </span>
                    </label>
                    <div class="file-upload-area" id="fileUploadArea">
                        <div class="file-upload-icon">üìé</div>
                        <div class="file-upload-text">
                            Arrastra y suelta archivos aqu√≠ o haz clic para seleccionarlos
                        </div>
                        <label for="fileUpload" class="file-input-label">
                            Seleccionar archivos
                        </label>
                        <input type="file" id="fileUpload" class="file-input" accept="image/*,video/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx" multiple>
                    </div>
                    
                    <!-- Mensaje de √©xito -->
                    <div class="file-success-message" id="fileSuccessMessage">
                        ‚úÖ Archivo subido con √©xito
                    </div>
                    
                    <!-- Lista de archivos -->
                    <div class="files-list" id="filesListContainer">
                        <h4>Archivos seleccionados:</h4>
                        <div id="filesList">
                            <!-- Los archivos se mostrar√°n aqu√≠ -->
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn-submit-announcement" id="submitAnnouncementBtn">
                    <span id="submitBtnText">Publicar Anuncio</span>
                    <span id="submitLoading" class="loading" style="display: none;"></span>
                </button>
            </form>
            <div id="formMessage" class="message"></div>
            
            <!-- Instrucciones para el usuario -->
            <div class="instructions">
                <h4>¬øC√≥mo funciona?</h4>
                <ul>
                    <li>Completa todos los campos del formulario</li>
                    <li>Haz clic en "Publicar Anuncio" para guardar tu anuncio en la nube</li>
                    <li>Tu anuncio se sincronizar√° autom√°ticamente con todos los dispositivos</li>
                    <li>El administrador podr√° ver tu anuncio desde cualquier dispositivo</li>
                    <li>El administrador puede ver, editar o eliminar anuncios desde la vista de administrador</li>
                </ul>
            </div>
        </section>

        <!-- Secci√≥n para mostrar anuncios del departamento -->
        <section id="announcementsSection" class="announcements-section">
            <div class="step-nav">
                <button id="backToAnnouncementsBtn" class="back-btn">‚Üê Volver</button>
                <h2 class="step-title" id="currentDepartmentTitle">Anuncios del Departamento</h2>
                <button id="createAnnouncementBtn" class="submit-btn" style="padding: 0.5rem 1rem; font-size: 0.9rem;">+ Crear Anuncio</button>
            </div>
            <div id="announcementsContainer" class="announcements-container">
                <!-- Los anuncios se cargar√°n aqu√≠ din√°micamente -->
                <div class="empty-message" id="emptyMessage">
                    No hay anuncios para este departamento. ¬°Crea el primer anuncio!
                </div>
            </div>
        </section>

        <!-- Panel de administrador -->
        <section id="adminPanel" class="admin-panel">
            <div class="step-nav">
                <button id="backToMainFromAdminBtn" class="back-btn">‚Üê Volver</button>
                <h2 class="step-title">Panel de Administrador - Todos los Anuncios</h2>
                <div style="display: flex; gap: 0.5rem;">
                    <button id="multiDeleteBtn" class="multi-delete-btn" style="display: none;">
                        üóëÔ∏è Eliminar Varios
                    </button>
                    <button id="refreshCloudBtn" class="submit-btn" style="padding: 0.5rem 1rem; font-size: 0.9rem; background-color: var(--verde);">üîÑ Actualizar</button>
                </div>
            </div>
            
            <!-- Barra de herramientas para selecci√≥n m√∫ltiple -->
            <div class="selection-toolbar" id="selectionToolbar">
                <div class="selection-info" id="selectionInfo">
                    0 anuncios seleccionados
                </div>
                <div class="selection-actions">
                    <button class="select-all-btn" id="selectAllBtn">Seleccionar Todos</button>
                    <button class="delete-selected-btn" id="deleteSelectedBtn">Eliminar Seleccionados</button>
                    <button class="cancel-selection-btn" id="cancelSelectionBtn">Cancelar</button>
                </div>
            </div>
            
            <div class="current-department">
                <h3>Vista completa de todos los anuncios de todos los departamentos</h3>
                <p style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;">
                    Aqu√≠ puedes ver, editar y eliminar todos los anuncios publicados por los usuarios desde cualquier dispositivo.
                </p>
            </div>
            <div id="adminAnnouncements" class="admin-announcements">
                <!-- Los anuncios del panel de administrador se cargar√°n aqu√≠ -->
                <div class="empty-message" id="adminEmptyMessage">
                    No hay anuncios para mostrar.
                </div>
            </div>
        </section>
    </main>

    <!-- Modal de detalles para administrador -->
    <div id="detailsModal" class="details-modal">
        <div class="details-content">
            <div class="details-header">
                <h3>Detalles del Anuncio</h3>
                <button id="closeDetailsBtn" class="details-close">√ó</button>
            </div>
            <div class="details-body" id="detailsBody">
                <!-- Los detalles se cargar√°n aqu√≠ din√°micamente -->
            </div>
        </div>
    </div>

    <!-- Panel de edici√≥n de anuncios -->
    <div id="editPanel" class="edit-panel">
        <div class="edit-form">
            <div class="edit-header">
                <h3>Editar Anuncio</h3>
                <button id="closeEditBtn" class="close-btn">√ó</button>
            </div>
            <form id="editAnnouncementForm">
                <input type="hidden" id="editId">
                <input type="hidden" id="editAuthor">
                <div class="announcement-form">
                    <div class="form-control">
                        <label for="editDepartment">Departamento:</label>
                        <input type="text" id="editDepartment" readonly style="background-color: #f3f4f6;">
                    </div>
                    <div class="form-control">
                        <label for="editTime">Hora de inicio (opcional):</label>
                        <input type="time" id="editTime">
                    </div>
                    <div class="form-control">
                        <label for="editEndTime">Hora de fin (opcional):</label>
                        <input type="time" id="editEndTime">
                    </div>
                    <div class="form-control">
                        <label for="editDate">Fecha de inicio:</label>
                        <input type="date" id="editDate" required>
                    </div>
                    <div class="form-control">
                        <label for="editEndDate">Fecha de fin (opcional):</label>
                        <input type="date" id="editEndDate">
                    </div>
                    <div class="form-control">
                        <label for="editTitle">T√≠tulo del anuncio:</label>
                        <input type="text" id="editTitle" placeholder="Ej: Reuni√≥n de oraci√≥n" required>
                    </div>
                    <div class="form-control">
                        <label for="editAuthorDisplay">Autor:</label>
                        <input type="text" id="editAuthorDisplay" style="background-color: #f3f4f6;">
                    </div>
                    <div class="form-control full-width">
                        <label for="editDescription">Descripci√≥n:</label>
                        <textarea id="editDescription" placeholder="Describe los detalles del anuncio..." required></textarea>
                    </div>
                    <div class="form-control" style="grid-column: 1 / -1; display: flex; gap: 1rem;">
                        <button type="submit" class="btn-submit-announcement" style="flex: 1;" id="saveEditBtn">
                            <span id="saveEditText">Guardar Cambios</span>
                            <span id="saveEditLoading" class="loading" style="display: none;"></span>
                        </button>
                        <button type="button" id="cancelEditBtn" class="btn-submit-announcement" style="background-color: var(--gris); flex: 1;">Cancelar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de √©xito -->
    <div id="successModal" class="success-modal">
        <div class="success-modal-content">
            <div class="success-icon" id="successIcon">‚úì</div>
            <h3 id="successTitle">¬°Operaci√≥n Exitosa!</h3>
            <p id="successMessage">La operaci√≥n se complet√≥ correctamente.</p>
            <button id="closeSuccessModal" class="submit-btn">Aceptar</button>
        </div>
    </div>

    <!-- Estado de conexi√≥n -->
    <div id="connectionStatus" class="connection-status">
        <span id="connectionStatusText">Conectando...</span>
    </div>

    <script>
        // Credenciales de administrador
        const ADMIN_CREDENTIALS = {
            username: "Admin",
            password: "Aa.1234#"
        };

        // Estado de la aplicaci√≥n
        let announcements = [];
        let isAdminLoggedIn = false;
        let currentUser = null;
        let currentDepartment = null;
        let deviceId = null;
        let lastView = 'departmentSelection';
        let isProcessing = false;
        let needsReload = false;
        let selectedFiles = [];
        let selectedAnnouncements = new Set();
        let isSelectionMode = false;

        // Elementos del DOM
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const adminViewBtn = document.getElementById('adminViewBtn');
        const loginForm = document.getElementById('loginForm');
        const submitLogin = document.getElementById('submitLogin');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const departmentSelection = document.getElementById('departmentSelection');
        const juvenilSelection = document.getElementById('juvenilSelection');
        const clubesSelection = document.getElementById('clubesSelection');
        const announcementFormSection = document.getElementById('announcementFormSection');
        const announcementsSection = document.getElementById('announcementsSection');
        const adminPanel = document.getElementById('adminPanel');
        const backToDepartmentsBtn = document.getElementById('backToDepartmentsBtn');
        const backToJuvenilBtn = document.getElementById('backToJuvenilBtn');
        const backToSelectionBtn = document.getElementById('backToSelectionBtn');
        const backToAnnouncementsBtn = document.getElementById('backToAnnouncementsBtn');
        const backToMainFromAdminBtn = document.getElementById('backToMainFromAdminBtn');
        const createAnnouncementBtn = document.getElementById('createAnnouncementBtn');
        const refreshCloudBtn = document.getElementById('refreshCloudBtn');
        const syncStatus = document.getElementById('syncStatus');
        const syncStatusText = document.getElementById('syncStatusText');
        const connectionStatus = document.getElementById('connectionStatus');
        const connectionStatusText = document.getElementById('connectionStatusText');
        const successModal = document.getElementById('successModal');
        const successTitle = document.getElementById('successTitle');
        const successMessage = document.getElementById('successMessage');
        const successIcon = document.getElementById('successIcon');
        const closeSuccessModal = document.getElementById('closeSuccessModal');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const loadingTitle = document.getElementById('loadingTitle');
        const loadingMessage = document.getElementById('loadingMessage');
        const fileUpload = document.getElementById('fileUpload');
        const fileUploadArea = document.getElementById('fileUploadArea');
        const filesList = document.getElementById('filesList');
        const filesListContainer = document.getElementById('filesListContainer');
        const fileSuccessMessage = document.getElementById('fileSuccessMessage');
        const detailsModal = document.getElementById('detailsModal');
        const closeDetailsBtn = document.getElementById('closeDetailsBtn');
        const detailsBody = document.getElementById('detailsBody');
        const multiDeleteBtn = document.getElementById('multiDeleteBtn');
        const selectionToolbar = document.getElementById('selectionToolbar');
        const selectionInfo = document.getElementById('selectionInfo');
        const selectAllBtn = document.getElementById('selectAllBtn');
        const deleteSelectedBtn = document.getElementById('deleteSelectedBtn');
        const cancelSelectionBtn = document.getElementById('cancelSelectionBtn');

        // Funci√≥n para convertir hora de 24h a 12h con AM/PM
        function convertTo12Hour(time) {
            if (!time) return 'No especificada';
            
            const [hours, minutes] = time.split(':');
            let hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            
            hour = hour % 12;
            hour = hour === 0 ? 12 : hour;
            
            return `${hour}:${minutes} ${ampm}`;
        }

        // Funci√≥n para formatear tama√±o de archivo
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Funci√≥n para obtener icono seg√∫n tipo de archivo
        function getFileIcon(fileType) {
            if (fileType.startsWith('image/')) return 'üñºÔ∏è';
            if (fileType.startsWith('video/')) return 'üé¨';
            if (fileType === 'application/pdf') return 'üìÑ';
            if (fileType.includes('word') || fileType.includes('document')) return 'üìù';
            if (fileType.includes('excel') || fileType.includes('spreadsheet')) return 'üìä';
            if (fileType.includes('powerpoint') || fileType.includes('presentation')) return 'üìΩÔ∏è';
            return 'üìé';
        }

        // Funci√≥n para obtener nombre del tipo de archivo
        function getFileTypeName(fileType) {
            if (fileType.startsWith('image/')) return 'Imagen';
            if (fileType.startsWith('video/')) return 'Video';
            if (fileType === 'application/pdf') return 'Documento PDF';
            if (fileType.includes('word') || fileType.includes('document')) return 'Documento Word';
            if (fileType.includes('excel') || fileType.includes('spreadsheet')) return 'Hoja de c√°lculo Excel';
            if (fileType.includes('powerpoint') || fileType.includes('presentation')) return 'Presentaci√≥n PowerPoint';
            return 'Archivo';
        }

        // Inicializar la aplicaci√≥n
        function initApp() {
            // Verificar si necesitamos recargar
            if (sessionStorage.getItem('needsReload') === 'true') {
                sessionStorage.removeItem('needsReload');
                showLoadingOverlay('Actualizando p√°gina...', 'La p√°gina se est√° recargando para mostrar los datos actualizados.');
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
                return;
            }
            
            // Establecer fecha m√≠nima en los campos de fecha
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').min = today;
            document.getElementById('endDate').min = today;
            document.getElementById('editDate').min = today;
            document.getElementById('editEndDate').min = today;
            
            // Generar un ID √∫nico para el dispositivo
            if (!localStorage.getItem('deviceId')) {
                deviceId = 'device_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
                localStorage.setItem('deviceId', deviceId);
            } else {
                deviceId = localStorage.getItem('deviceId');
            }
            
            // Generar un ID √∫nico para el usuario actual (si no existe)
            if (!localStorage.getItem('currentUserId')) {
                const userId = 'user_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('currentUserId', userId);
            }
            
            currentUser = localStorage.getItem('currentUserId');
            
            // Mostrar estado de conexi√≥n
            syncStatus.style.display = 'block';
            syncStatusText.textContent = 'Conectando con la base de datos...';
            
            // Cargar anuncios desde Firebase
            loadAnnouncementsFromFirebase();
            
            // Verificar si hay sesi√≥n de administrador activa
            const adminSession = localStorage.getItem('adminSession');
            if (adminSession === 'active') {
                isAdminLoggedIn = true;
                updateLoginUI();
            }
            
            // Configurar event listeners
            setupEventListeners();
            
            // Mostrar vista inicial
            showView('departmentSelection');
        }

        // Mostrar overlay de carga
        function showLoadingOverlay(title = 'Cargando...', message = 'Por favor espera mientras se actualiza la p√°gina.') {
            loadingTitle.textContent = title;
            loadingMessage.textContent = message;
            loadingOverlay.classList.add('active');
        }

        // Ocultar overlay de carga
        function hideLoadingOverlay() {
            loadingOverlay.classList.remove('active');
        }

        // Actualizar estado de conexi√≥n
        function updateConnectionStatus(connected) {
            if (connected) {
                connectionStatus.className = 'connection-status online';
                connectionStatusText.textContent = '‚úÖ Conectado a la nube';
            } else {
                connectionStatus.className = 'connection-status offline';
                connectionStatusText.textContent = '‚ö†Ô∏è Sin conexi√≥n a la nube';
            }
        }

        // Cargar anuncios desde Firebase
        function loadAnnouncementsFromFirebase() {
            if (!window.firebaseDatabase) {
                console.error("Firebase no est√° inicializado");
                syncStatusText.textContent = 'Error: Firebase no inicializado';
                syncStatus.className = 'message error';
                return;
            }
            
            try {
                // Referencia a la base de datos
                const announcementsRef = window.firebaseRef(window.firebaseDatabase, 'announcements');
                
                // Escuchar cambios en tiempo real
                window.firebaseOnValue(announcementsRef, (snapshot) => {
                    const data = snapshot.val();
                    
                    if (data) {
                        // Convertir objeto a array
                        announcements = Object.values(data);
                        
                        // Ordenar por ID (m√°s reciente primero)
                        announcements.sort((a, b) => b.id - a.id);
                        
                        console.log(`Cargados ${announcements.length} anuncios desde Firebase`);
                        
                        // Actualizar estado de sincronizaci√≥n
                        syncStatusText.textContent = `‚úÖ Sincronizado con la nube (${announcements.length} anuncios)`;
                        syncStatus.className = 'message success';
                        updateConnectionStatus(true);
                        
                        // Actualizar las vistas si est√°n activas
                        updateAllViews();
                        
                    } else {
                        announcements = [];
                        syncStatusText.textContent = '‚úÖ Base de datos vac√≠a';
                        syncStatus.className = 'message info';
                        updateAllViews();
                    }
                }, (error) => {
                    console.error("Error cargando datos de Firebase:", error);
                    syncStatusText.textContent = '‚ö†Ô∏è Error de conexi√≥n con la base de datos';
                    syncStatus.className = 'message error';
                    updateConnectionStatus(false);
                });
                
            } catch (error) {
                console.error("Error en loadAnnouncementsFromFirebase:", error);
                syncStatusText.textContent = '‚ö†Ô∏è Error cr√≠tico de conexi√≥n';
                syncStatus.className = 'message error';
                updateConnectionStatus(false);
            }
        }

        // Actualizar todas las vistas activas
        function updateAllViews() {
            // Si estamos en vista de anuncios, actualizar
            if (announcementsSection.classList.contains('active')) {
                renderAnnouncements();
            }
            
            // Si estamos en vista de admin, actualizar
            if (adminPanel.classList.contains('active')) {
                renderAdminAnnouncements();
            }
        }

        // Guardar anuncios en Firebase
        async function saveAnnouncementToFirebase(announcement) {
            if (!window.firebaseDatabase) {
                console.error("Firebase no est√° inicializado");
                return false;
            }
            
            try {
                // Generar un ID √∫nico para el anuncio si no tiene
                if (!announcement.id) {
                    announcement.id = Date.now();
                }
                
                // Guardar en Firebase
                const announcementRef = window.firebaseRef(window.firebaseDatabase, 'announcements/' + announcement.id);
                await window.firebaseSet(announcementRef, announcement);
                console.log("Anuncio guardado en Firebase:", announcement.id);
                return true;
            } catch (error) {
                console.error("Error guardando en Firebase:", error);
                return false;
            }
        }

        // Eliminar anuncio de Firebase
        async function deleteAnnouncementFromFirebase(id) {
            if (!window.firebaseDatabase) {
                console.error("Firebase no est√° inicializado");
                return false;
            }
            
            try {
                const announcementRef = window.firebaseRef(window.firebaseDatabase, 'announcements/' + id);
                await window.firebaseRemove(announcementRef);
                console.log("Anuncio eliminado de Firebase:", id);
                return true;
            } catch (error) {
                console.error("Error eliminando de Firebase:", error);
                return false;
            }
        }

        // Eliminar m√∫ltiples anuncios
        async function deleteMultipleAnnouncements(ids) {
            if (!window.firebaseDatabase || ids.length === 0) {
                return false;
            }
            
            try {
                const deletePromises = ids.map(id => {
                    const announcementRef = window.firebaseRef(window.firebaseDatabase, 'announcements/' + id);
                    return window.firebaseRemove(announcementRef);
                });
                
                await Promise.all(deletePromises);
                console.log(`${ids.length} anuncios eliminados de Firebase`);
                return true;
            } catch (error) {
                console.error("Error eliminando m√∫ltiples anuncios de Firebase:", error);
                return false;
            }
        }

        // Mostrar modal de √©xito
        function showSuccessModal(title, message, icon = "‚úì") {
            successTitle.textContent = title;
            successMessage.textContent = message;
            successIcon.textContent = icon;
            successModal.classList.add('active');
        }

        // Configurar event listeners para archivos
        function setupFileEventListeners() {
            // Drag & drop
            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.classList.add('drag-over');
            });

            fileUploadArea.addEventListener('dragleave', () => {
                fileUploadArea.classList.remove('drag-over');
            });

            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.classList.remove('drag-over');
                
                if (e.dataTransfer.files.length) {
                    const files = Array.from(e.dataTransfer.files);
                    handleFilesSelection(files);
                }
            });

            // Click para seleccionar archivo
            fileUploadArea.addEventListener('click', () => {
                fileUpload.click();
            });

            // Cambio en el input de archivo
            fileUpload.addEventListener('change', (e) => {
                if (e.target.files.length) {
                    const files = Array.from(e.target.files);
                    handleFilesSelection(files);
                }
            });
        }

        // Manejar selecci√≥n de archivos
        function handleFilesSelection(files) {
            let validFiles = [];
            
            files.forEach(file => {
                // Validar tama√±o (max 10MB)
                const maxSize = 10 * 1024 * 1024; // 10MB
                if (file.size > maxSize) {
                    showMessage(`El archivo "${file.name}" es demasiado grande. El tama√±o m√°ximo es 10MB.`, 'error');
                    return;
                }

                // Validar tipo de archivo
                const validTypes = [
                    'image/jpeg',
                    'image/png',
                    'image/gif',
                    'image/webp',
                    'video/mp4',
                    'video/mpeg',
                    'video/ogg',
                    'video/webm',
                    'application/pdf',
                    'application/msword',
                    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                    'application/vnd.ms-excel',
                    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                    'application/vnd.ms-powerpoint',
                    'application/vnd.openxmlformats-officedocument.presentationml.presentation'
                ];

                if (!validTypes.includes(file.type)) {
                    showMessage(`Tipo de archivo "${file.name}" no permitido.`, 'error');
                    return;
                }

                validFiles.push(file);
            });
            
            if (validFiles.length === 0) return;
            
            // Agregar archivos v√°lidos a la lista
            validFiles.forEach(file => {
                // Verificar si ya existe un archivo con el mismo nombre
                if (selectedFiles.some(f => f.name === file.name)) {
                    // Buscar un nombre √∫nico
                    let counter = 1;
                    let originalName = file.name;
                    let extension = originalName.split('.').pop();
                    let nameWithoutExt = originalName.substring(0, originalName.lastIndexOf('.'));
                    
                    while (selectedFiles.some(f => f.name === file.name)) {
                        file.name = `${nameWithoutExt} (${counter}).${extension}`;
                        counter++;
                    }
                }
                
                selectedFiles.push(file);
            });
            
            // Mostrar mensaje de √©xito
            showFileSuccessMessage();
            
            // Actualizar la lista de archivos
            updateFilesList();
            
            // Mostrar contenedor de lista de archivos
            filesListContainer.style.display = 'block';
        }

        // Mostrar mensaje de √©xito al subir archivo
        function showFileSuccessMessage() {
            fileSuccessMessage.style.display = 'block';
            setTimeout(() => {
                fileSuccessMessage.style.display = 'none';
            }, 3000);
        }

        // Actualizar lista de archivos
        function updateFilesList() {
            filesList.innerHTML = '';
            
            if (selectedFiles.length === 0) {
                filesListContainer.style.display = 'none';
                return;
            }
            
            selectedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-info">
                        <div class="file-icon">${getFileIcon(file.type)}</div>
                        <div class="file-details">
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${getFileTypeName(file.type)} ‚Ä¢ ${formatFileSize(file.size)}</div>
                        </div>
                    </div>
                    <button class="file-remove" data-index="${index}">‚úñ</button>
                `;
                filesList.appendChild(fileItem);
            });
            
            // Agregar event listeners a los botones de eliminar
            document.querySelectorAll('.file-remove').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.target.getAttribute('data-index'));
                    selectedFiles.splice(index, 1);
                    updateFilesList();
                });
            });
        }

        // Configurar event listeners para selecci√≥n m√∫ltiple
        function setupMultiSelectionEventListeners() {
            // Bot√≥n para activar selecci√≥n m√∫ltiple
            multiDeleteBtn.addEventListener('click', () => {
                startSelectionMode();
            });
            
            // Bot√≥n para seleccionar todos
            selectAllBtn.addEventListener('click', () => {
                if (selectedAnnouncements.size === announcements.length) {
                    // Si ya est√°n todos seleccionados, deseleccionar todos
                    selectedAnnouncements.clear();
                } else {
                    // Seleccionar todos los anuncios
                    announcements.forEach(ann => {
                        selectedAnnouncements.add(ann.id);
                    });
                }
                updateSelectionUI();
            });
            
            // Bot√≥n para eliminar seleccionados
            deleteSelectedBtn.addEventListener('click', () => {
                deleteSelectedAnnouncements();
            });
            
            // Bot√≥n para cancelar selecci√≥n
            cancelSelectionBtn.addEventListener('click', () => {
                cancelSelectionMode();
            });
        }

        // Iniciar modo de selecci√≥n
        function startSelectionMode() {
            isSelectionMode = true;
            selectedAnnouncements.clear();
            
            // Mostrar/ocultar elementos
            multiDeleteBtn.style.display = 'none';
            selectionToolbar.classList.add('active');
            
            // Actualizar UI de los anuncios
            renderAdminAnnouncements();
        }

        // Cancelar modo de selecci√≥n
        function cancelSelectionMode() {
            isSelectionMode = false;
            selectedAnnouncements.clear();
            
            // Mostrar/ocultar elementos
            multiDeleteBtn.style.display = 'block';
            selectionToolbar.classList.remove('active');
            
            // Actualizar UI de los anuncios
            renderAdminAnnouncements();
        }

        // Actualizar UI de selecci√≥n
        function updateSelectionUI() {
            const count = selectedAnnouncements.size;
            selectionInfo.textContent = `${count} anuncio${count !== 1 ? 's' : ''} seleccionado${count !== 1 ? 's' : ''}`;
            
            // Actualizar checkboxes en los anuncios
            document.querySelectorAll('.announcement-checkbox').forEach(checkbox => {
                const announcementId = parseInt(checkbox.getAttribute('data-id'));
                checkbox.checked = selectedAnnouncements.has(announcementId);
            });
            
            // Actualizar texto del bot√≥n "Seleccionar Todos"
            selectAllBtn.textContent = selectedAnnouncements.size === announcements.length ? 
                'Deseleccionar Todos' : 'Seleccionar Todos';
        }

        // Manejar selecci√≥n/deselecci√≥n de un anuncio
        function toggleAnnouncementSelection(id) {
            if (selectedAnnouncements.has(id)) {
                selectedAnnouncements.delete(id);
            } else {
                selectedAnnouncements.add(id);
            }
            updateSelectionUI();
        }

        // Eliminar anuncios seleccionados
        async function deleteSelectedAnnouncements() {
            if (selectedAnnouncements.size === 0) {
                showMessage('No hay anuncios seleccionados para eliminar.', 'warning');
                return;
            }
            
            if (!confirm(`¬øEst√°s seguro de que quieres eliminar ${selectedAnnouncements.size} anuncio(s)?`)) {
                return;
            }
            
            if (isProcessing) return;
            isProcessing = true;
            
            const idsToDelete = Array.from(selectedAnnouncements);
            
            // Intentar eliminar de Firebase
            const firebaseSuccess = await deleteMultipleAnnouncements(idsToDelete);
            
            isProcessing = false;
            
            if (firebaseSuccess) {
                // Cancelar modo de selecci√≥n
                cancelSelectionMode();
                
                // Mostrar modal de √©xito
                showSuccessModal(
                    '¬°Anuncios Eliminados!', 
                    `${idsToDelete.length} anuncio(s) se han eliminado exitosamente. La p√°gina se recargar√° autom√°ticamente.`,
                    'üóëÔ∏è'
                );
                
                // Mostrar overlay de carga y recargar despu√©s de 2 segundos
                setTimeout(() => {
                    showLoadingOverlay('Actualizando...', 'La p√°gina se est√° recargando para actualizar la lista de anuncios...');
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                }, 2000);
                
            } else {
                showMessage('Error al eliminar los anuncios. Intenta nuevamente.', 'error');
            }
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Configurar event listeners para archivos
            setupFileEventListeners();
            
            // Configurar event listeners para selecci√≥n m√∫ltiple
            setupMultiSelectionEventListeners();
            
            // Toggle formulario de login
            loginBtn.addEventListener('click', () => {
                loginForm.classList.toggle('active');
            });
            
            // Cerrar formulario de login al hacer clic fuera
            document.addEventListener('click', (e) => {
                if (!loginForm.contains(e.target) && e.target !== loginBtn) {
                    loginForm.classList.remove('active');
                }
            });
            
            // Enviar formulario de login
            submitLogin.addEventListener('click', handleLogin);
            
            // Tambi√©n permitir login con Enter
            usernameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });
            
            passwordInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });
            
            // Cerrar sesi√≥n
            logoutBtn.addEventListener('click', handleLogout);
            
            // Bot√≥n de vista admin
            adminViewBtn.addEventListener('click', showAdminView);
            
            // Bot√≥n para crear anuncio
            createAnnouncementBtn.addEventListener('click', () => {
                showView('form');
            });
            
            // Bot√≥n para refrescar datos
            refreshCloudBtn.addEventListener('click', () => {
                syncStatusText.textContent = 'Actualizando datos...';
                syncStatus.className = 'message info';
                // Simular recarga forzando una nueva lectura
                loadAnnouncementsFromFirebase();
                setTimeout(() => {
                    showSuccessModal('¬°Datos Actualizados!', 'Los anuncios se han actualizado correctamente.', 'üîÑ');
                }, 300);
            });
            
            // Botones de navegaci√≥n
            backToDepartmentsBtn.addEventListener('click', () => {
                handleReturnToDepartments();
            });
            
            backToJuvenilBtn.addEventListener('click', () => {
                handleReturnToDepartments();
            });
            
            backToSelectionBtn.addEventListener('click', () => {
                handleReturnToDepartments();
            });
            
            backToAnnouncementsBtn.addEventListener('click', () => {
                handleReturnToDepartments();
            });
            
            backToMainFromAdminBtn.addEventListener('click', () => {
                handleReturnToDepartments();
            });
            
            // Enviar formulario de anuncio
            document.getElementById('announcementForm').addEventListener('submit', handleAnnouncementSubmit);
            
            // Cerrar panel de edici√≥n
            document.getElementById('closeEditBtn').addEventListener('click', closeEditPanel);
            document.getElementById('cancelEditBtn').addEventListener('click', closeEditPanel);
            
            // Enviar formulario de edici√≥n
            document.getElementById('editAnnouncementForm').addEventListener('submit', handleEditAnnouncement);
            
            // Cerrar panel de edici√≥n al hacer clic fuera
            document.getElementById('editPanel').addEventListener('click', (e) => {
                if (e.target === document.getElementById('editPanel')) {
                    closeEditPanel();
                }
            });
            
            // Cerrar modal de detalles
            closeDetailsBtn.addEventListener('click', closeDetailsModal);
            
            // Cerrar modal de detalles al hacer clic fuera
            detailsModal.addEventListener('click', (e) => {
                if (e.target === detailsModal) {
                    closeDetailsModal();
                }
            });
            
            // Cerrar modal de √©xito
            closeSuccessModal.addEventListener('click', () => {
                successModal.classList.remove('active');
            });
            
            // Cerrar modal de √©xito al hacer clic fuera
            successModal.addEventListener('click', (e) => {
                if (e.target === successModal) {
                    successModal.classList.remove('active');
                }
            });
            
            // Seleccionar departamento (excepto Ministerio Joven)
            document.querySelectorAll('.department-card:not([data-department="Ministerio Joven"])').forEach(card => {
                card.addEventListener('click', (e) => {
                    const department = card.getAttribute('data-department');
                    selectDepartment(department);
                });
            });
            
            // Seleccionar Ministerio Joven
            document.querySelector('.department-card[data-department="Ministerio Joven"]').addEventListener('click', () => {
                showView('juvenil');
            });
            
            // Seleccionar opci√≥n JA o Clubes
            document.querySelectorAll('.option-card').forEach(card => {
                card.addEventListener('click', () => {
                    const option = card.getAttribute('data-option');
                    
                    if (option === 'JA') {
                        selectDepartment('JA');
                    } else if (option === 'Clubes') {
                        showView('clubes');
                    }
                });
            });
            
            // Seleccionar subcategor√≠a de Clubes
            document.querySelectorAll('.subcategory-card').forEach(card => {
                card.addEventListener('click', () => {
                    const department = card.getAttribute('data-department');
                    selectDepartment(department);
                });
            });
        }

        // Manejar retorno a departamentos
        function handleReturnToDepartments() {
            showLoadingOverlay('Actualizando...', 'Preparando la selecci√≥n de departamentos...');
            
            // Limpiar estado actual
            currentDepartment = null;
            announcements = [];
            selectedFiles = [];
            
            // Esperar 2 segundos y luego recargar
            setTimeout(() => {
                sessionStorage.setItem('needsReload', 'true');
                window.location.reload();
            }, 2000);
        }

        // Manejar login de administrador
        function handleLogin() {
            const username = usernameInput.value.trim();
            const password = passwordInput.value;
            
            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                isAdminLoggedIn = true;
                localStorage.setItem('adminSession', 'active');
                updateLoginUI();
                showSuccessModal('¬°Sesi√≥n Iniciada!', 'Sesi√≥n de administrador iniciada correctamente.', 'üîê');
                loginForm.classList.remove('active');
                usernameInput.value = '';
                passwordInput.value = '';
            } else {
                showMessage('Credenciales incorrectas. Intenta nuevamente.', 'error');
            }
        }

        // Manejar logout de administrador
        function handleLogout() {
            isAdminLoggedIn = false;
            localStorage.removeItem('adminSession');
            updateLoginUI();
            showSuccessModal('¬°Sesi√≥n Cerrada!', 'Sesi√≥n de administrador cerrada correctamente.', 'üö™');
            
            // Volver a vista de departamentos
            showView('departmentSelection');
        }

        // Actualizar la UI seg√∫n el estado de login
        function updateLoginUI() {
            if (isAdminLoggedIn) {
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'block';
                adminViewBtn.style.display = 'block';
                multiDeleteBtn.style.display = 'flex';
            } else {
                loginBtn.style.display = 'block';
                logoutBtn.style.display = 'none';
                adminViewBtn.style.display = 'none';
                multiDeleteBtn.style.display = 'none';
            }
        }

        // Mostrar diferentes vistas
        function showView(view) {
            // Guardar la vista anterior
            if (view !== lastView) {
                lastView = getCurrentView();
            }
            
            // Ocultar todas las vistas primero
            hideAllViews();
            
            // Mostrar la vista correspondiente
            if (view === 'departmentSelection') {
                departmentSelection.style.display = 'block';
                document.getElementById('welcomeMessage').style.display = 'block';
            } else if (view === 'juvenil') {
                juvenilSelection.style.display = 'block';
            } else if (view === 'clubes') {
                clubesSelection.style.display = 'block';
            } else if (view === 'form') {
                announcementFormSection.classList.add('active');
                document.getElementById('formSectionTitle').textContent = `Crear Anuncio para: ${currentDepartment}`;
                document.getElementById('selectedDepartment').value = currentDepartment;
            } else if (view === 'announcements') {
                announcementsSection.classList.add('active');
                document.getElementById('currentDepartmentTitle').textContent = `Anuncios: ${currentDepartment}`;
                renderAnnouncements();
            } else if (view === 'admin') {
                adminPanel.classList.add('active');
                renderAdminAnnouncements();
            }
        }

        // Obtener vista actual
        function getCurrentView() {
            if (departmentSelection.style.display === 'block') return 'departmentSelection';
            if (juvenilSelection.style.display === 'block') return 'juvenil';
            if (clubesSelection.style.display === 'block') return 'clubes';
            if (announcementFormSection.classList.contains('active')) return 'form';
            if (announcementsSection.classList.contains('active')) return 'announcements';
            if (adminPanel.classList.contains('active')) return 'admin';
            return 'departmentSelection';
        }

        // Ocultar todas las vistas
        function hideAllViews() {
            departmentSelection.style.display = 'none';
            juvenilSelection.style.display = 'none';
            clubesSelection.style.display = 'none';
            announcementFormSection.classList.remove('active');
            announcementsSection.classList.remove('active');
            adminPanel.classList.remove('active');
            document.getElementById('welcomeMessage').style.display = 'none';
        }

        // Seleccionar un departamento
        function selectDepartment(department) {
            currentDepartment = department;
            document.getElementById('currentDepartmentTitle').textContent = `Anuncios: ${department}`;
            showView('announcements');
        }

        // Mostrar vista de administrador
        function showAdminView() {
            if (!isAdminLoggedIn) {
                showMessage('Debes iniciar sesi√≥n como administrador primero.', 'error');
                loginForm.classList.add('active');
                return;
            }
            
            showView('admin');
        }

        // Manejar env√≠o de nuevo anuncio
        async function handleAnnouncementSubmit(e) {
            e.preventDefault();
            
            if (isProcessing) return;
            isProcessing = true;
            
            // Obtener valores del formulario
            const department = document.getElementById('selectedDepartment').value;
            const time = document.getElementById('time').value || null;
            const endTime = document.getElementById('endTime').value || null;
            const title = document.getElementById('title').value.trim();
            const description = document.getElementById('description').value.trim();
            const date = document.getElementById('date').value;
            const endDate = document.getElementById('endDate').value || null;
            const author = document.getElementById('author').value.trim();
            
            // Validar campos
            if (!title || !description || !date || !author) {
                showMessage('Por favor completa todos los campos obligatorios.', 'error');
                isProcessing = false;
                return;
            }
            
            // Mostrar estado de carga
            document.getElementById('submitBtnText').textContent = 'Publicando...';
            document.getElementById('submitLoading').style.display = 'inline-block';
            document.getElementById('submitAnnouncementBtn').disabled = true;
            
            // Crear nuevo anuncio
            const newAnnouncement = {
                id: Date.now(), // Usar timestamp como ID √∫nico
                department,
                time,
                endTime,
                title,
                description,
                date: date,
                endDate,
                author: author,
                authorId: currentUser,
                deviceId: deviceId,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // Procesar archivos si existen
            if (selectedFiles.length > 0) {
                newAnnouncement.files = [];
                
                // Procesar cada archivo
                const processFiles = async () => {
                    for (const file of selectedFiles) {
                        try {
                            const fileData = await convertFileToBase64(file);
                            newAnnouncement.files.push({
                                name: file.name,
                                type: file.type,
                                size: file.size,
                                data: fileData.split(',')[1], // Remover el prefijo data:...
                                uploadedAt: new Date().toISOString()
                            });
                        } catch (error) {
                            console.error("Error procesando archivo:", error);
                        }
                    }
                    
                    // Guardar en Firebase despu√©s de procesar todos los archivos
                    const firebaseSuccess = await saveAnnouncementToFirebase(newAnnouncement);
                    
                    // Restaurar bot√≥n
                    document.getElementById('submitBtnText').textContent = 'Publicar Anuncio';
                    document.getElementById('submitLoading').style.display = 'none';
                    document.getElementById('submitAnnouncementBtn').disabled = false;
                    isProcessing = false;
                    
                    if (firebaseSuccess) {
                        // Limpiar formulario
                        resetForm();
                        
                        // Mostrar modal de √©xito
                        showSuccessModal(
                            '¬°Anuncio Publicado!', 
                            'Tu anuncio se ha publicado exitosamente. La p√°gina se recargar√° autom√°ticamente.',
                            'üì¢'
                        );
                        
                        // Mostrar overlay de carga y recargar despu√©s de 2 segundos
                        setTimeout(() => {
                            showLoadingOverlay('Actualizando...', 'La p√°gina se est√° recargando para mostrar tu anuncio...');
                            setTimeout(() => {
                                window.location.reload();
                            }, 2000);
                        }, 2000);
                        
                    } else {
                        showMessage('Error al publicar el anuncio. Intenta nuevamente.', 'error');
                    }
                };
                
                processFiles();
            } else {
                // No hay archivos, guardar directamente
                const firebaseSuccess = await saveAnnouncementToFirebase(newAnnouncement);
                
                // Restaurar bot√≥n
                document.getElementById('submitBtnText').textContent = 'Publicar Anuncio';
                document.getElementById('submitLoading').style.display = 'none';
                document.getElementById('submitAnnouncementBtn').disabled = false;
                isProcessing = false;
                
                if (firebaseSuccess) {
                    // Limpiar formulario
                    resetForm();
                    
                    // Mostrar modal de √©xito
                    showSuccessModal(
                        '¬°Anuncio Publicado!', 
                        'Tu anuncio se ha publicado exitosamente. La p√°gina se recargar√° autom√°ticamente.',
                        'üì¢'
                    );
                    
                    // Mostrar overlay de carga y recargar despu√©s de 2 segundos
                    setTimeout(() => {
                        showLoadingOverlay('Actualizando...', 'La p√°gina se est√° recargando para mostrar tu anuncio...');
                        setTimeout(() => {
                            window.location.reload();
                        }, 2000);
                    }, 2000);
                    
                } else {
                    showMessage('Error al publicar el anuncio. Intenta nuevamente.', 'error');
                }
            }
        }

        // Convertir archivo a base64
        function convertFileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // Limpiar formulario
        function resetForm() {
            document.getElementById('time').value = '';
            document.getElementById('endTime').value = '';
            document.getElementById('title').value = '';
            document.getElementById('date').value = '';
            document.getElementById('endDate').value = '';
            document.getElementById('description').value = '';
            filesListContainer.style.display = 'none';
            fileUpload.value = '';
            selectedFiles = [];
        }

        // Manejar edici√≥n de anuncio
        async function handleEditAnnouncement(e) {
            e.preventDefault();
            
            if (isProcessing) return;
            isProcessing = true;
            
            // Obtener valores del formulario
            const id = parseInt(document.getElementById('editId').value);
            const time = document.getElementById('editTime').value || null;
            const endTime = document.getElementById('editEndTime').value || null;
            const title = document.getElementById('editTitle').value.trim();
            const description = document.getElementById('editDescription').value.trim();
            const date = document.getElementById('editDate').value;
            const endDate = document.getElementById('editEndDate').value || null;
            const author = document.getElementById('editAuthorDisplay').value.trim();
            
            // Validar campos
            if (!title || !description || !date || !author) {
                showMessage('Por favor completa todos los campos obligatorios.', 'error');
                isProcessing = false;
                return;
            }
            
            // Mostrar estado de carga
            document.getElementById('saveEditText').textContent = 'Guardando...';
            document.getElementById('saveEditLoading').style.display = 'inline-block';
            document.getElementById('saveEditBtn').disabled = true;
            
            // Buscar el anuncio a editar
            const announcement = announcements.find(ann => ann.id === id);
            
            if (announcement) {
                // Crear anuncio actualizado
                const updatedAnnouncement = {
                    ...announcement,
                    time,
                    endTime,
                    title,
                    description,
                    date,
                    endDate,
                    author,
                    updatedAt: new Date().toISOString()
                };
                
                // Guardar en Firebase
                const firebaseSuccess = await saveAnnouncementToFirebase(updatedAnnouncement);
                
                // Restaurar bot√≥n
                document.getElementById('saveEditText').textContent = 'Guardar Cambios';
                document.getElementById('saveEditLoading').style.display = 'none';
                document.getElementById('saveEditBtn').disabled = false;
                isProcessing = false;
                
                if (firebaseSuccess) {
                    // Cerrar panel de edici√≥n
                    closeEditPanel();
                    
                    // Mostrar modal de √©xito
                    showSuccessModal(
                        '¬°Anuncio Actualizado!', 
                        'El anuncio se ha actualizado exitosamente. La p√°gina se recargar√° autom√°ticamente.',
                        '‚úèÔ∏è'
                    );
                    
                    // Mostrar overlay de carga y recargar despu√©s de 2 segundos
                    setTimeout(() => {
                        showLoadingOverlay('Actualizando...', 'La p√°gina se est√° recargando para mostrar los cambios...');
                        setTimeout(() => {
                            window.location.reload();
                        }, 2000);
                    }, 2000);
                    
                } else {
                    showMessage('Error al actualizar el anuncio. Intenta nuevamente.', 'error');
                }
            } else {
                document.getElementById('saveEditText').textContent = 'Guardar Cambios';
                document.getElementById('saveEditLoading').style.display = 'none';
                document.getElementById('saveEditBtn').disabled = false;
                isProcessing = false;
                showMessage('El anuncio no se encontr√≥.', 'error');
            }
        }

        // Abrir panel de edici√≥n para un anuncio espec√≠fico
        function openEditPanel(id) {
            // Si estamos en modo selecci√≥n, no abrir edici√≥n
            if (isSelectionMode) return;
            
            // Buscar el anuncio
            const announcement = announcements.find(ann => ann.id === id);
            
            if (announcement) {
                // Llenar el formulario con los datos del anuncio
                document.getElementById('editId').value = announcement.id;
                document.getElementById('editAuthorDisplay').value = announcement.author;
                document.getElementById('editDepartment').value = announcement.department;
                document.getElementById('editTime').value = announcement.time || '';
                document.getElementById('editEndTime').value = announcement.endTime || '';
                document.getElementById('editTitle').value = announcement.title;
                document.getElementById('editDate').value = announcement.date;
                document.getElementById('editEndDate').value = announcement.endDate || '';
                document.getElementById('editDescription').value = announcement.description;
                
                // Mostrar el panel de edici√≥n
                document.getElementById('editPanel').classList.add('active');
            }
        }

        // Cerrar panel de edici√≥n
        function closeEditPanel() {
            document.getElementById('editPanel').classList.remove('active');
            document.getElementById('editAnnouncementForm').reset();
            
            // Restaurar texto del bot√≥n por si acaso
            document.getElementById('saveEditText').textContent = 'Guardar Cambios';
            document.getElementById('saveEditLoading').style.display = 'none';
            document.getElementById('saveEditBtn').disabled = false;
        }

        // Abrir modal de detalles
        function openDetailsModal(id) {
            // Si estamos en modo selecci√≥n, no abrir detalles
            if (isSelectionMode) return;
            
            // Buscar el anuncio
            const announcement = announcements.find(ann => ann.id === id);
            
            if (announcement) {
                // Convertir horas a formato 12h
                const startTime = announcement.time ? convertTo12Hour(announcement.time) : 'No especificada';
                const endTime = announcement.endTime ? convertTo12Hour(announcement.endTime) : 'No especificada';
                
                // Generar contenido para archivos (solo informaci√≥n esencial)
                let filesContent = '';
                if (announcement.files && announcement.files.length > 0) {
                    filesContent = `
                        <div class="details-section">
                            <h4>Archivos Adjuntos (${announcement.files.length})</h4>
                            ${announcement.files.map((file, index) => `
                                <div class="file-preview-container">
                                    <div class="detail-row">
                                        <div class="detail-label">Archivo ${index + 1}:</div>
                                        <div class="detail-value">
                                            ${getFileIcon(file.type)} ${file.name}
                                            <span style="color: var(--gris); font-size: 0.9rem;">
                                                (${getFileTypeName(file.type)} ‚Ä¢ ${formatFileSize(file.size)})
                                            </span>
                                        </div>
                                    </div>
                                    <div class="file-preview">
                                        ${generateFilePreview(file)}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                // Construir contenido del modal - SOLO INFORMACI√ìN ESENCIAL
                const detailsContent = `
                    <div class="details-section">
                        <h4>Informaci√≥n del Anuncio</h4>
                        <div class="detail-row">
                            <div class="detail-label">T√≠tulo:</div>
                            <div class="detail-value">${announcement.title}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Departamento:</div>
                            <div class="detail-value">${announcement.department}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Autor:</div>
                            <div class="detail-value">${announcement.author}</div>
                        </div>
                    </div>
                    
                    <div class="details-section">
                        <h4>Fecha y Hora</h4>
                        <div class="detail-row">
                            <div class="detail-label">Fecha de inicio:</div>
                            <div class="detail-value">${announcement.date}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Hora de inicio:</div>
                            <div class="detail-value">${startTime}</div>
                        </div>
                        ${announcement.endDate ? `
                        <div class="detail-row">
                            <div class="detail-label">Fecha de fin:</div>
                            <div class="detail-value">${announcement.endDate}</div>
                        </div>
                        ` : ''}
                        ${announcement.endTime ? `
                        <div class="detail-row">
                            <div class="detail-label">Hora de fin:</div>
                            <div class="detail-value">${endTime}</div>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="details-section">
                        <h4>Descripci√≥n</h4>
                        <div class="detail-value">${announcement.description}</div>
                    </div>
                    
                    ${filesContent}
                `;
                
                detailsBody.innerHTML = detailsContent;
                detailsModal.classList.add('active');
            }
        }

        // Generar vista previa de archivo
        function generateFilePreview(file) {
            if (file.type.startsWith('image/')) {
                const base64Data = `data:${file.type};base64,${file.data}`;
                return `<img src="${base64Data}" class="image-preview" alt="${file.name}">`;
            } else if (file.type.startsWith('video/')) {
                const base64Data = `data:${file.type};base64,${file.data}`;
                return `<video controls class="video-preview">
                    <source src="${base64Data}" type="${file.type}">
                    Tu navegador no soporta la reproducci√≥n de video.
                </video>`;
            } else if (file.type === 'application/pdf') {
                const base64Data = `data:${file.type};base64,${file.data}`;
                return `<iframe src="${base64Data}" class="pdf-preview" title="${file.name}"></iframe>`;
            } else {
                return `
                    <div class="no-preview">
                        <div class="preview-icon">${getFileIcon(file.type)}</div>
                        <p>Vista previa no disponible para este tipo de archivo</p>
                        <p style="font-size: 0.8rem; color: var(--gris); margin-top: 0.5rem;">
                            ${getFileTypeName(file.type)} ‚Ä¢ ${formatFileSize(file.size)}
                        </p>
                        <div class="preview-actions">
                            <button class="preview-download-btn" onclick="downloadFileFromDetails(${announcement.id}, ${index})">
                                ‚¨áÔ∏è Descargar Archivo
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        // Descargar archivo desde detalles
        function downloadFileFromDetails(announcementId, fileIndex) {
            const announcement = announcements.find(ann => ann.id === announcementId);
            if (announcement && announcement.files && announcement.files[fileIndex]) {
                const file = announcement.files[fileIndex];
                const byteCharacters = atob(file.data);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray], { type: file.type });
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = file.name;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }

        // Cerrar modal de detalles
        function closeDetailsModal() {
            detailsModal.classList.remove('active');
        }

        // Eliminar un anuncio individual
        async function deleteAnnouncement(id) {
            // Si estamos en modo selecci√≥n, usar toggle de selecci√≥n
            if (isSelectionMode) {
                toggleAnnouncementSelection(id);
                return;
            }
            
            if (isProcessing) return;
            
            if (confirm('¬øEst√°s seguro de que quieres eliminar este anuncio?')) {
                isProcessing = true;
                
                // Intentar eliminar de Firebase
                const firebaseSuccess = await deleteAnnouncementFromFirebase(id);
                
                isProcessing = false;
                
                if (firebaseSuccess) {
                    // Mostrar modal de √©xito
                    showSuccessModal(
                        '¬°Anuncio Eliminado!', 
                        'El anuncio se ha eliminado exitosamente. La p√°gina se recargar√° autom√°ticamente.',
                        'üóëÔ∏è'
                    );
                    
                    // Mostrar overlay de carga y recargar despu√©s de 2 segundos
                    setTimeout(() => {
                        showLoadingOverlay('Actualizando...', 'La p√°gina se est√° recargando para actualizar la lista de anuncios...');
                        setTimeout(() => {
                            window.location.reload();
                        }, 2000);
                    }, 2000);
                    
                } else {
                    showMessage('Error al eliminar el anuncio. Intenta nuevamente.', 'error');
                }
            }
        }

        // Renderizar anuncios del departamento actual
        function renderAnnouncements() {
            // Filtrar anuncios del departamento actual
            let departmentAnnouncements = announcements.filter(ann => ann.department === currentDepartment);
            
            // Mostrar mensaje si no hay anuncios
            const emptyMessage = document.getElementById('emptyMessage');
            const announcementsContainer = document.getElementById('announcementsContainer');
            
            if (departmentAnnouncements.length === 0) {
                emptyMessage.style.display = 'block';
                announcementsContainer.innerHTML = '';
                announcementsContainer.appendChild(emptyMessage);
                return;
            }
            
            // Ocultar mensaje de vac√≠o
            emptyMessage.style.display = 'none';
            
            // Generar HTML de los anuncios
            let announcementsHTML = '';
            
            // Ordenar por fecha (m√°s cercana primero)
            const sortedAnnouncements = [...departmentAnnouncements].sort((a, b) => {
                return new Date(a.date) - new Date(b.date);
            });
            
            sortedAnnouncements.forEach(announcement => {
                const createdDate = new Date(announcement.createdAt);
                const formattedDate = createdDate.toLocaleDateString('es-ES', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // Convertir horas a formato 12h
                const startTime = announcement.time ? convertTo12Hour(announcement.time) : 'No especificada';
                const endTime = announcement.endTime ? convertTo12Hour(announcement.endTime) : null;
                
                announcementsHTML += `
                    <div class="announcement-card" id="announcement-${announcement.id}">
                        <h3>${announcement.title}</h3>
                        <div class="announcement-category">${announcement.department}</div>
                        <div class="announcement-meta">
                            <span><strong>Hora de inicio:</strong> ${startTime}</span>
                            ${endTime ? `<span><strong>Hora de fin:</strong> ${endTime}</span>` : ''}
                            <span><strong>Fecha de inicio:</strong> ${announcement.date}</span>
                            ${announcement.endDate ? `<span><strong>Fecha de fin:</strong> ${announcement.endDate}</span>` : ''}
                        </div>
                        <div class="announcement-description">
                            ${announcement.description}
                        </div>
                        <div class="announcement-author">
                            <strong>Publicado por:</strong> ${announcement.author}
                            <span style="font-size: 0.7rem; color: #666; display: block; margin-top: 0.2rem;">
                                Publicado el: ${formattedDate}
                            </span>
                        </div>
                    </div>
                `;
            });
            
            announcementsContainer.innerHTML = announcementsHTML;
        }

        // Renderizar todos los anuncios en el panel de administrador
        function renderAdminAnnouncements() {
            // Mostrar mensaje si no hay anuncios
            const adminEmptyMessage = document.getElementById('adminEmptyMessage');
            const adminAnnouncementsContainer = document.getElementById('adminAnnouncements');
            
            if (announcements.length === 0) {
                adminEmptyMessage.style.display = 'block';
                adminAnnouncementsContainer.innerHTML = '';
                adminAnnouncementsContainer.appendChild(adminEmptyMessage);
                return;
            }
            
            // Ocultar mensaje de vac√≠o
            adminEmptyMessage.style.display = 'none';
            
            // Generar HTML de los anuncios
            let adminAnnouncementsHTML = '';
            
            // Ordenar por departamento y fecha
            const sortedAnnouncements = [...announcements].sort((a, b) => {
                if (a.department === b.department) {
                    return new Date(a.date) - new Date(b.date);
                }
                return a.department.localeCompare(b.department);
            });
            
            sortedAnnouncements.forEach(announcement => {
                const createdDate = new Date(announcement.createdAt);
                const formattedDate = createdDate.toLocaleDateString('es-ES', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // Convertir horas a formato 12h
                const startTime = announcement.time ? convertTo12Hour(announcement.time) : 'No especificada';
                const endTime = announcement.endTime ? convertTo12Hour(announcement.endTime) : null;
                
                // Contar archivos adjuntos
                const fileCount = announcement.files ? announcement.files.length : 0;
                
                // Clases CSS para modo selecci√≥n
                const selectableClass = isSelectionMode ? 'selectable' : '';
                const checkbox = isSelectionMode ? 
                    `<input type="checkbox" class="announcement-checkbox" data-id="${announcement.id}" onclick="toggleAnnouncementSelection(${announcement.id})">` : 
                    '';
                
                adminAnnouncementsHTML += `
                    <div class="announcement-card ${selectableClass}" id="admin-announcement-${announcement.id}">
                        ${checkbox}
                        <div class="announcement-actions">
                            ${!isSelectionMode ? `
                                <button class="action-btn details-btn" onclick="openDetailsModal(${announcement.id})">
                                    üëÅÔ∏è
                                </button>
                                <button class="action-btn edit-btn" onclick="openEditPanel(${announcement.id})">
                                    ‚úèÔ∏è
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteAnnouncement(${announcement.id})">
                                    üóëÔ∏è
                                </button>
                            ` : ''}
                        </div>
                        <h3>${announcement.title}</h3>
                        <div class="announcement-category">${announcement.department}</div>
                        <div class="announcement-meta">
                            <span><strong>Hora de inicio:</strong> ${startTime}</span>
                            ${endTime ? `<span><strong>Hora de fin:</strong> ${endTime}</span>` : ''}
                            <span><strong>Fecha de inicio:</strong> ${announcement.date}</span>
                            ${announcement.endDate ? `<span><strong>Fecha de fin:</strong> ${announcement.endDate}</span>` : ''}
                        </div>
                        <div class="announcement-description">
                            ${announcement.description}
                        </div>
                        <div class="announcement-author">
                            <strong>Publicado por:</strong> ${announcement.author}
                            ${fileCount > 0 ? `
                                <span style="font-size: 0.7rem; color: var(--morado); display: block; margin-top: 0.2rem;">
                                    üìé ${fileCount} archivo(s) adjunto(s)
                                </span>
                            ` : ''}
                            <span style="font-size: 0.7rem; color: #666; display: block; margin-top: 0.2rem;">
                                Publicado el: ${formattedDate}
                            </span>
                        </div>
                    </div>
                `;
            });
            
            adminAnnouncementsContainer.innerHTML = adminAnnouncementsHTML;
            
            // Actualizar UI de selecci√≥n si estamos en modo selecci√≥n
            if (isSelectionMode) {
                updateSelectionUI();
            }
        }

        // Mostrar mensajes temporales
        function showMessage(text, type) {
            const formMessage = document.getElementById('formMessage');
            formMessage.textContent = text;
            formMessage.className = `message ${type}`;
            
            // Ocultar mensaje despu√©s de 3 segundos
            setTimeout(() => {
                formMessage.style.display = 'none';
            }, 3000);
        }

        // Inicializar la aplicaci√≥n cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Hacer funciones disponibles globalmente
        window.openDetailsModal = openDetailsModal;
        window.downloadFileFromDetails = downloadFileFromDetails;
        window.openEditPanel = openEditPanel;
        window.deleteAnnouncement = deleteAnnouncement;
        window.toggleAnnouncementSelection = toggleAnnouncementSelection;
    </script>
</body>
</html>
